<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Loading — OBIXConfig Doctor</title>
<style>
  :root{--bg:#0b0f14;--card:#121821;--primary:#7c8cff;--text:#eaeaff;--muted:#9aa4b2}
  *{box-sizing:border-box}body{margin:0;height:100vh;background:radial-gradient(circle at top,var(--card),var(--bg));display:flex;align-items:center;justify-content:center;color:var(--text);font-family: "Sarabun", system-ui, sans-serif}
  .card{background:rgba(18,24,33,.95);border-radius:18px;padding:36px 28px;width:92%;max-width:420px;text-align:center;box-shadow:0 12px 40px rgba(0,0,0,.6)}
  .logo{font-weight:700;color:var(--primary);font-size:20px;margin-bottom:18px}
  .spinner{width:64px;height:64px;border:5px solid rgba(255,255,255,.12);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 18px}
  @keyframes spin{to{transform:rotate(360deg)}}
  .status{color:var(--muted);min-height:24px}
  .footer{margin-top:16px;font-size:12px;color:var(--muted)}
</style>
</head>
<body>
  <div class="card">
    <div class="logo">OBIXConfig Doctor</div>
    <div class="spinner" aria-hidden="true"></div>
    <div class="status" id="status">กำลังปลุกระบบ... กรุณารอสักครู่</div>
    <div class="footer">Powered by OBIXConfig Lab</div>
  </div>

  <script>
    // friendly rotating messages
    const steps = [
      "กำลังเชื่อมต่อเซิร์ฟเวอร์...",
      "กำลังโหลดระบบวิเคราะห์...",
      "เตรียมอินเทอร์เฟซผู้ใช้...",
      "เกือบเสร็จแล้ว..."
    ];
    let i = 0;
    setInterval(()=> {
      document.getElementById('status').innerText = steps[i % steps.length];
      i++;
    }, 1100);

    // poll backend /ping every 1.5s; when ready go to /app
    async function checkBackend(){
      try{
        const res = await fetch('/ping', {cache: 'no-store'});
        if(res.ok){
          window.location.replace('/app');
        }
      }catch(e){
        // ignore errors (still offline)
      }
    }
    setInterval(checkBackend, 1500);
    // also attempt immediate check after small delay
    setTimeout(checkBackend, 600);
  </script>
</body>
</html>