<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Obixconfig Doctor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
    --bg-color-light: #f5f5f5;
    --text-color-light: #111;
    --card-color-light: #fff;

    --bg-color-dark: #121212;
    --text-color-dark: #eee;
    --card-color-dark: #1e1e1e;
}

body.light {
    background-color: var(--bg-color-light);
    color: var(--text-color-light);
}

body.light .container, body.light .form-card, body.light .result-card {
    background-color: var(--card-color-light);
}

body.dark {
    background-color: var(--bg-color-dark);
    color: var(--text-color-dark);
}

body.dark .container, body.dark .form-card, body.dark .result-card {
    background-color: var(--card-color-dark);
}

button.toggle-theme {
    position: fixed;
    top: 10px;
    right: 10px;
    padding: 6px 12px;
    cursor: pointer;
}
</style>

<script>
function copyText(id) {
    const text = document.getElementById(id).innerText;
    navigator.clipboard.writeText(text);
    alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Betaflight ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß");
}

// Dark/Light toggle
function toggleTheme() {
    document.body.classList.toggle('dark');
    document.body.classList.toggle('light');
    localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
}

window.onload = () => {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.body.classList.add(savedTheme);
}
</script>
</head>

<body>
<div class="top-bar center-logo">
  <img src="{{ url_for('static', filename='img/obix-logo.png') }}" class="logo">

  <button class="toggle-theme" onclick="toggleTheme()">üåó</button>
</div>

<div class="container">

<form method="POST" class="form-card">
    <label>‡∏Ç‡∏ô‡∏≤‡∏î‡πÇ‡∏î‡∏£‡∏ô (‡∏ô‡∏¥‡πâ‡∏ß)</label>
    <input type="number" name="size" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5" required>

    <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÇ‡∏î‡∏£‡∏ô (‡∏Å‡∏£‡∏±‡∏°)</label>
    <input type="number" name="weight" placeholder="‡πÄ‡∏ä‡πà‡∏ô 950" required>

    <label>‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà</label>
    <select name="battery">
        <option value="4S">4S</option>
        <option value="6S">6S</option>
    </select>

    <label>‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô</label>
    <select name="style">
        <option value="freestyle">Freestyle</option>
        <option value="longrange">Long Range / Cinematic</option>
        <option value="racing">Racing</option>
    </select>

    <label>‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏ö‡∏û‡∏±‡∏î (‡∏ô‡∏¥‡πâ‡∏ß)</label>
    <input type="number" name="prop_size" value="5" required>

    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ö‡∏û‡∏±‡∏î</label>
    <select name="blades">
        <option value="2">2 ‡πÉ‡∏ö</option>
        <option value="3" selected>3 ‡πÉ‡∏ö</option>
        <option value="4">4 ‡πÉ‡∏ö</option>
    </select>

    <label>Pitch ‡πÉ‡∏ö‡∏û‡∏±‡∏î</label>
    <input type="number" step="0.1" name="pitch" value="4.0" required>

    <button type="submit">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
</form>

{% if analysis %}
<section class="flight-summary">
  <h2>üîç Flight Summary</h2>

  <p class="summary-main">
    {{ analysis.summary }}
  </p>

  <div class="summary-grid">
    <div class="summary-item">
      <span class="label">Style</span>
      <span class="value">{{ analysis.style }}</span>
    </div>

    <div class="summary-item">
      <span class="label">Weight Class</span>
      <span class="value">{{ analysis.weight_class }}</span>
    </div>

    <div class="summary-item">
      <span class="label">Power Ratio</span>
      <span class="value">{{ analysis.thrust_ratio }}</span>
    </div>

    <div class="summary-item">
      <span class="label">Est. Flight Time</span>
      <span class="value">{{ analysis.flight_time }} min</span>
    </div>
  </div>
</section>
<div class="result-card">
<h2>üîç ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>
<p><strong>{{ analysis.overview }}</strong></p>

<h3>‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
<ul>
{% for tip in analysis.basic_tips %}
<li>{{ tip }}</li>
{% endfor %}
</ul>

<h3>‚öôÔ∏è PID (‡∏Ñ‡πà‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</h3>
<pre id="pid">
ROLL  P {{ analysis.pid.roll.p }}  I {{ analysis.pid.roll.i }}  D {{ analysis.pid.roll.d }}
PITCH P {{ analysis.pid.pitch.p }} I {{ analysis.pid.pitch.i }} D {{ analysis.pid.pitch.d }}
YAW   P {{ analysis.pid.yaw.p }}   I {{ analysis.pid.yaw.i }}
</pre>
<button onclick="copyText('pid')">Copy PID</button>

<h3>üß† Filter</h3>
<pre id="filter">
Gyro LPF2: {{ analysis.filter.gyro_lpf2 }} Hz
D-Term LPF1: {{ analysis.filter.dterm_lpf1 }} Hz
Dynamic Notch: {{ analysis.filter.dyn_notch }}
</pre>
<button onclick="copyText('filter')">Copy Filter</button>

<h3>üõ©Ô∏è ‡πÉ‡∏ö‡∏û‡∏±‡∏î</h3>
<p>{{ analysis.prop_result.summary }}</p>
<ul>
<li>Noise: {{ analysis.prop_result.effect.noise }}</li>
<li>Motor Load: {{ analysis.prop_result.effect.motor_load }}</li>
<li>Grip: {{ analysis.prop_result.effect.grip }}</li>
<li>Recommendation: {{ analysis.prop_result.recommendation }}</li>
</ul>

<h3>üí° Extra Tools</h3>
<p>Thrust-to-Weight Ratio: {{ analysis.thrust_ratio }}</p>
<p>Battery Runtime Estimate: {{ analysis.battery_est }} ‡∏ô‡∏≤‡∏ó‡∏µ</p>

<h3>üìä Visualization</h3>
<canvas id="thrustChart" width="400" height="200"></canvas>
<canvas id="noiseChart" width="400" height="200"></canvas>

<script>
const thrustCtx = document.getElementById('thrustChart').getContext('2d');
new Chart(thrustCtx, {
    type: 'bar',
    data: {
        labels: ['Thrust-to-Weight'],
        datasets: [{
            label: 'Ratio',
            data: [{{ analysis.thrust_ratio }}],
            backgroundColor: ['rgba(54, 162, 235, 0.6)']
        }]
    },
    options: { scales: { y: { beginAtZero: true } } }
});

const noiseCtx = document.getElementById('noiseChart').getContext('2d');
new Chart(noiseCtx, {
    type: 'line',
    data: {
        labels: ['Motor Load', 'Noise Level'],
        datasets: [{
            label: 'Effect',
            data: [{{ analysis.prop_result.effect.motor_load }}, {{ analysis.prop_result.effect.noise }}],
            fill: false,
            borderColor: 'rgb(255, 99, 132)',
            tension: 0.3
        }]
    },
    options: { scales: { y: { beginAtZero: true } } }
});
</script>

</div>
{% endif %}

COMMUNITY & VERSION ===================== -->
<div class="community-box">
  <p class="community-text">
    ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ <strong>OBIXConfig Doctor</strong> ‡∏¢‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ üöß<br><br>

    ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πá‡∏ö<br>
    üëâ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÇ‡∏î‡∏£‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏´‡∏ô<br>
    üëâ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏≠‡∏∞‡πÑ‡∏£<br><br>

    <span class="highlight">
      ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏à<br>
      <strong>OBIXConfig Lab</strong>
    </span><br><br>

    ‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏°‡∏ä‡∏ô FPV ‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‚ù§Ô∏è
  </p>

  <a href="https://www.facebook.com/banmysanti/"
     target="_blank"
     class="community-btn">
     ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏à OBIXConfig Lab
  </a>
</div>

<div class="version-note">
  OBIXConfig Doctor ‚Ä¢ v0.9 beta (Community Build)<br>
  Developed by real FPV pilots üáπüá≠
</div>

</footer>
</div>
</body>
</html>
